<%= render 'breadcrumb' %>

<div class="readonly_data">
  <h2><%= @course %></h2>
  
  <p>
    <%= t(
      'view.teaches.between.html',
      start: l(@teach.start, format: :long),
      finish: l(@teach.finish, format: :long)
    ) %>
  </p>
  
  <ul class="nav nav-tabs">
    <li class="active">
      <%= link_to(
        Teach.human_attribute_name('scores', count: 0),
        '#scores_container', data: { toggle: 'tab' }
      ) %>
    </li>
    <li>
      <%= link_to(
        Teach.human_attribute_name('enrollments', count: 0),
        '#enrollments_container', data: { toggle: 'tab' }
      ) %>
    </li>
  </ul>
  
  <div class="tab-content">
    <div id="scores_container" class="tab-pane active">
      <% if @teach.scores.empty? %>
        <div class="alert"><%= t('view.teaches.without_scores.html') %></div>
      <% else %>
        <% grouped_scores = teach_scores_grouped_by_student(@teach) %>
        <table class="table table-striped table-bordered table-condensed">
          <thead>
            <tr>
              <th><%= Score.human_attribute_name 'user_id' %></th>
              <th colspan="<%= grouped_scores.first.last.size %>"></th>
            </tr>
          </thead>
          <tbody>
            <% grouped_scores.each do |user, scores| %>
              <tr>
                <td><%= user %></td>
                <% scores.each do |score| %>
                  <td><%= show_teach_score_details score %></td>
                <% end %>
              </tr>
            <% end %>
          </tbody>
        </table>
      <% end %>
    </div>
    
    <div id="enrollments_container" class="tab-pane">
      <% if @teach.enrollments.empty? %>
        <div class="alert"><%= t('view.teaches.without_entollments_in_show.html') %></div>
      <% else %>
        <% teach_splited_enrollments(@teach).each do |type, enrollments| %>
          <h4><%= type %></h4>
          <ul>
            <% enrollments.each do |enrollment| %>
              <li>
                <%= t(
                  'view.teaches.enrollment_info.html',
                  user: link_to_if(can?(:read, enrollment.user), enrollment.user.to_s, enrollment.user),
                  date: l(enrollment.created_at, format: :long)
                ) %>
              </li>
            <% end %>
          </ul>
        <% end %>
      <% end %>
    </div>
  </div>
</div>

<nav class="form-actions">
  <%= link_to t('label.edit'), edit_course_teach_path(@course, @teach), class: 'btn btn-primary' if can? :update, @teach %>
  <% if can? :read, Teach %>
    <div class="pull-right">
      <%= link_to t('label.list'), course_teaches_path(@course) %>
    </div>
  <% end %>
</nav>