<% if @comment.persisted? %>
  $('#new_comment').replaceWith('<%= j render(template: 'comments/show', format: :html) %>');

  window.location.hash = '<%= @comment.anchor %>';
  
  $("#<%= @comment.anchor %>").effect('highlight', 'slow').before(
    '<%= j render(template: 'comments/new', format: :html, locals: { :@comment => Comment.new }) %>'
  );
<% else %>
  $('#new_comment').replaceWith('<%= j render(template: 'comments/new', format: :html) %>');
<% end %>
